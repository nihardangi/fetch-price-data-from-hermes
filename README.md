## Latest Price Feed Update Fetcher

This repository showcases the capability of fetching latest price feed update from Hermes

Along with the above functionality, this repository contains a function that can modify the data received from Hermes to contain only the required price feed updates.

This helps in saving gas when we make a call to updatePriceFeeds() API which charges 1 wei/price feed update data.

## Hermes Documentation

Fetch price feeds API:
https://docs.pyth.network/price-feeds/fetch-price-updates

Update Price Feeds API:
https://api-reference.pyth.network/price-feeds/evm/updatePriceFeeds

1. Clone the repository

```bash
git clone git@github.com:nihardangi/fetch-price-data-from-hermes.git
```

2. Navigate into the project directory

```bash
cd fetch-price-data-from-hermes
```

3. To run the project

```bash
go run main.go
```

## Packet break down

We will fetch data for 2 priceFeedIDs:

1. 0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43
2. 0xc96458d393fe9deb7a7d63a0ac41e2898a67a7750dbd166673279e06c868df0a

Fetched data using this endpoint:

```
https://hermes.pyth.network/v2/updates/price/latest?ids[]=0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43&ids[]=0xc96458d393fe9deb7a7d63a0ac41e2898a67a7750dbd166673279e06c868df0a'
```

```
Original packet: 504e41550100000003b801000000040d022ef116f9c2e3d4bd1aea319f86fe3a0a7f3f695ec5864ff7aa959fed67b159e5223e24d0c293c82a20bd8244540071f40129809c0e708bc4911876123d816f2a0103f6918dafff0d1c2290daad6796ac9fe24f7d8ae446e0940679883400c99a94ac434de81e05674f14d5ce6b3aa3132c95fb32f3de3f73360060aa0b7ac566e59a000478f619a5d3bedab652f20658f236b8fd2b9a5fbe863f6489a70d77db033da56838da964747883a5fc5d62c48c35608d4baadafcd1f3aaa2f69af5aa5fb0a520900069b621c2c19e3a128a784ce55072e18fe6daba99389a04e52d15401712a8d664f0cd446fc6db6f3cdb5c984e5204434b12d5ef8d530e7756f088bf58b54f63b550108afea29789cb2cfd935ef1c13a42453ccb6ee9096c3e19aaaafb0081c3faa7a196cff9e90d0b401555cc5f9b0328ea8bf0c7ce62100a7a55d3e94ec464e0941d0010ab95be27f56193e52c2cf5544451ed4ddf35fe96d94235a433a396dbf5bb1371f45b4cbccc099c1997a5e2b8bd979b02dd53639f15ea168c4d1a157a79c87cb8c000bbeeb15f885f0f3ab2a60878413abec9ff86f8775b46b25af9f9d0e1a4bdb5f296bca0b94dccc75b09398f75b26dfa83d178e4ef7fc6308395d0bbcaa80d92c30000c97c45974cc604fe58ea53570885399daf1a063f6ec0959726819cb9d44772d9835b69705b0c3f87c37146c583e57a52e12e50c629c7b6cc507b6f7e4c4f84ae4000d006aaedab144ed12cdd5be11634f7edb4bd31940ed35eb95ee72f5019ac834c20b74dc103d12403e53f6e383085c383a48b71410c137e17c5260d11819abdab5010e80cffbaf9ab0cf90e5d1266562b8be86c581425ee8a28da31a20b4e3f02b2c9d4c3d7d4f22c68cafafad885a793ef1e988beea74c1c6db9e34184fb0eff7875c0110abb032a0aaa91115fedb792be21eb8950c5a1a7b1022487fc4e620897952c6af65803974b5da176dc2c795660adc6190f79e1a5427f419abd6ef6abaea8148780011877e29b4fa51a4450958294aa841f97469c43097f8c91a0d87ba5f8c3bb686a779da22b294a750a150654c36db889f9d2e2106cf8b9cf9dde8a73ece33d2d7af0012e46382fe06c0a46c4ac49fbcc8e0fa682b567d7978cb9fc9a72f8657ac6cca46128408b3a5a160889a51197d7df405697c5ae42568e131d5b3660b0cfa80d0a101685db97d00000000001ae101faedac5851e32b9b23b5f9411a8c2bac4aae3ed4dd7b811dd1a72ea4aa7100000000086ac27b014155575600000000000d784fc800002710da0251d853b8f9b7122870b11ae0dde3e525eeac02005500e62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43000009c5ecf7871b00000000cf89976ffffffff800000000685db97d00000000685db97c000009c9d538196000000000d2c1bbdc0c52be697c37a52864de9b88ec80fbba07b6afb50bef6e8937f3b96b0d60227583decbc16a87ff9978ed6bc7f579da2e7c40678eb68acdf650ec70d93731b3afda46ab8081a17321300e8ebd95efcd42260d5d1d49c233174cdd5a59a0956fc794b6c74aaa297c0f9383eb564c8bfe28ce58caec05638acd13253143dae14ed2713a2d8fccea613b5b437f88d80185dda961b954496658e51f82e6c6962e75ef869a841a175136b73e184024f98e493e85439aee0aedc4d7b94698ed73652779b18d8ec7320c98375f4c07f454c9f46860735004444da3bfd51b10c4a61e0f5638bea5b6075f38a9a66d441b0e2499621a005500c96458d393fe9deb7a7d63a0ac41e2898a67a7750dbd166673279e06c868df0a0000000000227e1a00000000000008f5fffffff800000000685db97d00000000685db97c000000000022955400000000000008580ce8f1d417aa9d788559d4c92ee86b5a9d9de34cdb7dce6f689bf99adcd087b4c9c71befc7e609f4fc96bce241523164efadf741c9fb85dedddb150bb27d0d093585299780036cff54bd2a4339e9a198ff358c85b33a6d0149feeb147cb3ae831bb73b151c82cad47b0dd81aae40017eec4d8b5012a7a7a53cd0f670ac0d0b537961e046117d8ad6cf2bcdf70a9da0298ce070d976ac5958930a53ef30d86244ea9a841a175136b73e184024f98e493e85439aee0aedc4d7b94698ed73652779b18d8ec7320c98375f4c07f454c9f46860735004444da3bfd51b10c4a61e0f5638bea5b6075f38a9a66d441b0e2499621a
```

In depth breakdown:

1. 10 byte PNAU VAA wrapper
   504e41550100000003b8

2. 1 byte version
   01

3. 4 byte guardian_set
   00000004

4. 1 byte sig_count (13)
   0d

5. Wormhole VAA (13\*66 bytes)
   022ef116f9c2e3d4bd1aea319f86fe3a0a7f3f695ec5864ff7aa959fed67b159e5223e24d0c293c82a20bd8244540071f40129809c0e708bc4911876123d816f2a0103f6918dafff0d1c2290daad6796ac9fe24f7d8ae446e0940679883400c99a94ac434de81e05674f14d5ce6b3aa3132c95fb32f3de3f73360060aa0b7ac566e59a000478f619a5d3bedab652f20658f236b8fd2b9a5fbe863f6489a70d77db033da56838da964747883a5fc5d62c48c35608d4baadafcd1f3aaa2f69af5aa5fb0a520900069b621c2c19e3a128a784ce55072e18fe6daba99389a04e52d15401712a8d664f0cd446fc6db6f3cdb5c984e5204434b12d5ef8d530e7756f088bf58b54f63b550108afea29789cb2cfd935ef1c13a42453ccb6ee9096c3e19aaaafb0081c3faa7a196cff9e90d0b401555cc5f9b0328ea8bf0c7ce62100a7a55d3e94ec464e0941d0010ab95be27f56193e52c2cf5544451ed4ddf35fe96d94235a433a396dbf5bb1371f45b4cbccc099c1997a5e2b8bd979b02dd53639f15ea168c4d1a157a79c87cb8c000bbeeb15f885f0f3ab2a60878413abec9ff86f8775b46b25af9f9d0e1a4bdb5f296bca0b94dccc75b09398f75b26dfa83d178e4ef7fc6308395d0bbcaa80d92c30000c97c45974cc604fe58ea53570885399daf1a063f6ec0959726819cb9d44772d9835b69705b0c3f87c37146c583e57a52e12e50c629c7b6cc507b6f7e4c4f84ae4000d006aaedab144ed12cdd5be11634f7edb4bd31940ed35eb95ee72f5019ac834c20b74dc103d12403e53f6e383085c383a48b71410c137e17c5260d11819abdab5010e80cffbaf9ab0cf90e5d1266562b8be86c581425ee8a28da31a20b4e3f02b2c9d4c3d7d4f22c68cafafad885a793ef1e988beea74c1c6db9e34184fb0eff7875c0110abb032a0aaa91115fedb792be21eb8950c5a1a7b1022487fc4e620897952c6af65803974b5da176dc2c795660adc6190f79e1a5427f419abd6ef6abaea8148780011877e29b4fa51a4450958294aa841f97469c43097f8c91a0d87ba5f8c3bb686a779da22b294a750a150654c36db889f9d2e2106cf8b9cf9dde8a73ece33d2d7af0012e46382fe06c0a46c4ac49fbcc8e0fa682b567d7978cb9fc9a72f8657ac6cca46128408b3a5a160889a51197d7df405697c5ae42568e131d5b3660b0cfa80d0a101

6. Body Header (51 bytes)
   Layout (big-endian):
   u32 timestamp
   u32 nonce
   u16 emitter_chain
   bytes32 emitter_address
   u64 sequence
   u8 consistency_level
   685db97d00000000001ae101faedac5851e32b9b23b5f9411a8c2bac4aae3ed4dd7b811dd1a72ea4aa7100000000086ac27b01

7. Magic
   41555756

8. Major
   00

9. Minor
   00

10. Trailing header size
    00

11. Trailing header (empty as trailing header size is 0)

12. Proof type
    00

13. Vaa size (value is 13)
    000d

14. VAA (13 bytes long as VAA size is 13)
    784fc800002710da0251d853b8

15. Unknown bytes (14 bytes long)
    f9b7122870b11ae0dde3e525eeac

16. Num Updates
    02

17. Message 1 Size (85)
    0055

18. Price Update Message 1 (85 bytes length)
    00e62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43000009c5ecf7871b00000000cf89976ffffffff800000000685db97d00000000685db97c000009c9d538196000000000d2c1bbdc

19. Num proofs for message 1 (12)
    0c

20. Proofs for message 1 (12 proofs, each 20 byte long: Total 240 bytes)
    52be697c37a52864de9b88ec80fbba07b6afb50bef6e8937f3b96b0d60227583decbc16a87ff9978ed6bc7f579da2e7c40678eb68acdf650ec70d93731b3afda46ab8081a17321300e8ebd95efcd42260d5d1d49c233174cdd5a59a0956fc794b6c74aaa297c0f9383eb564c8bfe28ce58caec05638acd13253143dae14ed2713a2d8fccea613b5b437f88d80185dda961b954496658e51f82e6c6962e75ef869a841a175136b73e184024f98e493e85439aee0aedc4d7b94698ed73652779b18d8ec7320c98375f4c07f454c9f46860735004444da3bfd51b10c4a61e0f5638bea5b6075f38a9a66d441b0e2499621a

21. Message2 Size (85)
    0055

22. Price update Message 2 (85 bytes length)
    00c96458d393fe9deb7a7d63a0ac41e2898a67a7750dbd166673279e06c868df0a0000000000227e1a00000000000008f5fffffff800000000685db97d00000000685db97c00000000002295540000000000000858

23. Num proofs for message 2 (12)
    0c

24. Proofs for message 2 (12 proofs, each 20 byte long: Total 240 bytes)
    e8f1d417aa9d788559d4c92ee86b5a9d9de34cdb7dce6f689bf99adcd087b4c9c71befc7e609f4fc96bce241523164efadf741c9fb85dedddb150bb27d0d093585299780036cff54bd2a4339e9a198ff358c85b33a6d0149feeb147cb3ae831bb73b151c82cad47b0dd81aae40017eec4d8b5012a7a7a53cd0f670ac0d0b537961e046117d8ad6cf2bcdf70a9da0298ce070d976ac5958930a53ef30d86244ea9a841a175136b73e184024f98e493e85439aee0aedc4d7b94698ed73652779b18d8ec7320c98375f4c07f454c9f46860735004444da3bfd51b10c4a61e0f5638bea5b6075f38a9a66d441b0e2499621a
